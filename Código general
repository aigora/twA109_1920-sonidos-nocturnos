#include <stdio.h>
#include <windows.h>
#include<conio.h>
#include<stdlib.h>

//introduzco la funcion de movimiento, en la cual introducimos la funcion SetConsolePosition para controlar la posicion en pantalla

void gotoxy (int x,int y) //con la funcion gotoxy establecemos unas coordenadas introducidas por nosotros
{
	HANDLE hCon;
	hCon = GetStdHandle (STD_OUTPUT_HANDLE);
	
	COORD dwPos; //estructura coordenada
	dwPos.X=x;
	dwPos.Y=y;
	

	SetConsoleCursorPosition (hCon,dwPos);	
}

void OcultarCursor()//con esto quitamos el molesto cursor que espera letras a introducir
{
	HANDLE hCon;
	hCon = GetStdHandle (STD_OUTPUT_HANDLE);
	CONSOLE_CURSOR_INFO cci;	//estructura del cursor
	cci.dwSize=50;
	cci.bVisible=FALSE;
		
	SetConsoleCursorInfo(hCon,&cci);
}

void pintar_limites (){
	for(int i = 2 ; i<78 ; i++) {
		gotoxy (i,3); printf ("%c", 205);
		gotoxy (i,33); printf ("%c",205);
	

	}
	
	for(int i=4 ; i< 33; i++){
		gotoxy (2,i); printf ("%c",186);
		gotoxy (77,i); printf ("%c",186);
	}
	
	gotoxy (2,3); printf("%c",201);
	gotoxy (2,33); printf("%c",200);
	gotoxy (77,3); printf("%c",187);
	gotoxy (77,33); printf("%c",188);	


	
}


class NAVE{
    int x,y;
    int corazones;
    int vidas;
public:
    NAVE(int _x, int _y , int _corazones, int _vidas ): x( _x), y(_y), corazones(_corazones), vidas(_vidas){}
    
    void pintar();
    void borrar();
    void mover();
    void pintar_corazones ();
    void morir();//se crea funcion
};


void NAVE::pintar()
{
	gotoxy(x,y); printf  ("  A  ");
	gotoxy(x,y+1); printf(" wHw ");
	gotoxy(x,y+2); printf("WWHWW");	
}

void NAVE::borrar()//para que la nave no deje una estela 
{
	gotoxy(x,y); printf  ("     ");
	gotoxy(x,y+1); printf("     ");
	gotoxy(x,y+2); printf("     ");
	
	
}

void NAVE::mover(){  //aqui se repara el cÃ³digo para que la nave no sobrepase los limites
    if (kbhit()){
    
    char tecla = getch();
                borrar();
                if((tecla=='a'or tecla=='A' && x>3)and x> 3)x--;
			if((tecla=='d'or tecla=='D' && x+6 < 77)and x+6 < 77)x++;
			if (tecla == 'e')corazones--;
                pintar();
                pintar_corazones ();
              
            }
}

void NAVE::pintar_corazones (){
	
	
	gotoxy(50,2);printf("VIDAS %d",vidas);
	gotoxy(64,2); printf("Salud");
	gotoxy(70,2); printf("      ");
	for (int i=0; i< corazones; i++){
		
		gotoxy (70+i,2); printf ("%c",38);
	}
}
void NAVE::morir(){
	
	if(corazones==0)
	{
		borrar();
		gotoxy(x,y); printf  ("     ");
		gotoxy(x,y+1); printf("  *  ");
		gotoxy(x,y+2); printf("     ");
		Sleep(200);
		
		borrar();
		gotoxy(x,y); printf  ("  *  ");
		gotoxy(x,y+1); printf(" * * ");
		gotoxy(x,y+2); printf("* * *");
		Sleep(200);	
		borrar();
		
		vidas--;
		corazones = 3;
		pintar_corazones();
		pintar();
		
	}
	
	
	
}

class MALOS{
	int x,y;
public:
	MALOS(int _x,int _y):x(_x),y(_y){}
	void pintar();
	void mover();
	
	
};

void MALOS::pintar(){
	gotoxy(x,y); printf("v");
		
}
void MALOS::mover(){
	gotoxy(x,y); printf(" ");
	y++;
	if(y>32){
		x=rand()%71 + 4;
		y=4;
		
	}
	pintar();
}

int main()
{
	OcultarCursor();
	pintar_limites ();
	NAVE USER(30,30,3,3);
	USER.pintar();
	USER.pintar_corazones ();

	MALOS malos(10,4);
	// introduzco ahora variable logica para que la funcion de movimiento
	//se ejecute hasta que muramos
	bool game_over = false;
	while(!game_over)
	{	
	malos.mover();
	USER.morir();
	USER.mover();

			Sleep(20);
	
		
	}
	
	
	
	return 0;
}
